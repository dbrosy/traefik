## Dynamic configuration
http:
  # Add the router
  routers:
    traefik:
      rule: Host(`${TRAEFIK_DOMAIN}`)
      entryPoints:
      - traefik
      service: api@internal
      tls:
        certresolver: letsencrypt
      middlewares: 
      - authtraefik
    http-catchall:
      rule: hostregexp(`{host:.+}`)
      entrypoints: 
      - web 
      middlewares:
      - redirect-to-https
  # Add the middleware
  middlewares:
    authtraefik:
      basicauth:
        users:
        - ${TRAEFIK_USER}:${TRAEFIK_PASSWORD_HASH}
    test-ipwhitelist:
      ipwhitelist:
        sourcerange: 
        - ${TRAEFIK_IP_WHITELIST}
    redirect-to-https:
      redirectscheme.echeme:
      - https
#tcp:
  # Add the router
#  routers:
#    rancher:
#      rule: HostSNI(`${RANCHER_DOMAIN}`)
#      entrypoints:
#      - websecure
#      tls:
#        passthrough: true
#      service: rancher
  # Add the service
#  services:
#    rancher:
#      loadBalancer:
#        servers:
#        - url: "http://192.168.71.146:443/"
